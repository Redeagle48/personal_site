!function(e){e.fn.poptrox_disableSelection=function(){return e(this).css("user-select","none").css("-khtml-user-select","none").css("-moz-user-select","none").css("-o-user-select","none").css("-webkit-user-select","none")},e.fn.poptrox=function(o){function t(){s=e(window).width(),r=e(window).height()+i.windowHeightPad}if(1<this.length){for(var p=0;p<this.length;p++)e(this[p]).poptrox(o);return e(this)}var i=e.extend({preload:!1,baseZIndex:1e3,fadeSpeed:300,overlayColor:"#000000",overlayOpacity:.6,windowMargin:50,windowHeightPad:0,selector:"a",popupSpeed:300,popupWidth:200,popupHeight:100,popupIsFixed:!1,useBodyOverflow:!0,usePopupEasyClose:!0,usePopupLoader:!0,usePopupCloser:!0,usePopupCaption:!1,usePopupNav:!1,usePopupDefaultStyling:!0,popupBackgroundColor:"#FFFFFF",popupTextColor:"#000000",popupLoaderTextSize:"2em",popupCloserBackgroundColor:"#000000",popupCloserTextColor:"#FFFFFF",popupCloserTextSize:"20px",popupPadding:10,popupCaptionHeight:60,popupCaptionTextSize:null,popupBlankCaptionText:"(untitled)",popupCloserText:"&#215;",popupLoaderText:"&bull;&bull;&bull;&bull;",popupClass:"poptrox-popup",popupSelector:null,popupLoaderSelector:".loader",popupCloserSelector:".closer",popupCaptionSelector:".caption",popupNavPreviousSelector:".nav-previous",popupNavNextSelector:".nav-next",onPopupClose:null,onPopupOpen:null},o);o=e(this);var s,r,n=e("body"),a=e("<div></div>"),c=e(window),u=[],l=0,d=!1,h=[],g=navigator.userAgent.match(/MSIE ([0-9]+)\./),p=g&&6==RegExp.$1,g=g&&8>RegExp.$1,f=p?"absolute":"fixed";i.usePopupLoader||(i.popupLoaderSelector=null),i.usePopupCloser||(i.popupCloserSelector=null),i.usePopupCaption||(i.popupCaptionSelector=null),i.usePopupNav||(i.popupNavPreviousSelector=null,i.popupNavNextSelector=null);var x;x=e(i.popupSelector?i.popupSelector:'<div class="'+i.popupClass+'">'+(i.popupLoaderSelector?'<div class="loader">'+i.popupLoaderText+"</div>":"")+'<div class="pic"></div>'+(i.popupCaptionSelector?'<div class="caption"></div>':"")+(i.popupCloserSelector?'<span class="closer">'+i.popupCloserText+"</span>":"")+(i.popupNavPreviousSelector?'<div class="nav-previous"></div>':"")+(i.popupNavNextSelector?'<div class="nav-next"></div>':"")+"</div>");var v=x.find(".pic"),w=e(),b=x.find(i.popupLoaderSelector),m=x.find(i.popupCaptionSelector),S=x.find(i.popupCloserSelector),C=x.find(i.popupNavNextSelector),y=x.find(i.popupNavPreviousSelector),P=C.add(y);if(i.usePopupDefaultStyling&&(x.css("background",i.popupBackgroundColor),x.css("color",i.popupTextColor),x.css("padding",i.popupPadding+"px"),0<m.length&&(x.css("padding-bottom",i.popupCaptionHeight+"px"),m.css("position","absolute").css("left","0").css("bottom","0").css("width","100%").css("text-align","center").css("height",i.popupCaptionHeight+"px").css("line-height",i.popupCaptionHeight+"px"),i.popupCaptionTextSize&&m.css("font-size",popupCaptionTextSize)),0<S.length&&S.html(i.popupCloserText).css("font-size",i.popupCloserTextSize).css("background",i.popupCloserBackgroundColor).css("color",i.popupCloserTextColor).css("display","block").css("width","40px").css("height","40px").css("line-height","40px").css("text-align","center").css("position","absolute").css("text-decoration","none").css("outline","0").css("top","0").css("right","-40px"),0<b.length&&b.html("").css("position","relative").css("font-size",i.popupLoaderTextSize).on("startSpinning",function(o){var t=e("<div>"+i.popupLoaderText+"</div>");t.css("height",Math.floor(i.popupHeight/2)+"px").css("overflow","hidden").css("line-height",Math.floor(i.popupHeight/2)+"px").css("text-align","center").css("margin-top",Math.floor((x.height()-t.height()+(0<m.length?m.height():0))/2)).css("color",i.popupTextColor?i.popupTextColor:"").on("xfin",function(){t.fadeTo(300,.5,function(){t.trigger("xfout")})}).on("xfout",function(){t.fadeTo(300,.05,function(){t.trigger("xfin")})}).trigger("xfin"),b.append(t)}).on("stopSpinning",function(e){b.find("div").remove()}),2==P.length)){P.css("font-size","75px").css("text-align","center").css("color","#fff").css("text-shadow","none").css("height","100%").css("position","absolute").css("top","0").css("opacity","0.35").css("cursor","pointer").css("box-shadow","inset 0px 0px 10px 0px rgba(0,0,0,0)").poptrox_disableSelection();var k,T;i.usePopupEasyClose?T=k="100px":(k="75%",T="25%"),C.css("right","0").css("width",k).html('<div style="position: absolute; height: 100px; width: 125px; top: 50%; right: 0; margin-top: -50px;">&gt;</div>'),y.css("left","0").css("width",T).html('<div style="position: absolute; height: 100px; width: 125px; top: 50%; left: 0; margin-top: -50px;">&lt;</div>')}return c.on("orientationchange",function(){c.trigger("resize")}).resize(function(){t(),x.trigger("poptrox_close")}),m.on("update",function(e,o){o&&0!=o.length||(o=i.popupBlankCaptionText),m.html(o)}),S.css("cursor","pointer").on("click",function(e){return e.preventDefault(),e.stopPropagation(),x.trigger("poptrox_close"),!0}),C.on("click",function(){x.trigger("poptrox_next")}),y.on("click",function(){x.trigger("poptrox_previous")}),a.prependTo(g?"body":"html").hide(),p?a.css("position","absolute"):a.css("position",f).css("left",0).css("top",0).css("z-index",i.baseZIndex).css("width","200%").css("height","200%").css("background-color",i.overlayColor),a.css("cursor","pointer").on("click",function(e){e.preventDefault(),e.stopPropagation(),x.trigger("poptrox_close")}),i.usePopupEasyClose&&v.css("cursor","pointer").on("click",function(e){e.preventDefault(),e.stopPropagation(),x.trigger("poptrox_close")}),x.on("poptrox_next",function(){var e=l+1;e>=u.length&&(e=0),x.trigger("poptrox_switch",[e])}).on("poptrox_previous",function(){var e=l-1;0>e&&(e=u.length-1),x.trigger("poptrox_switch",[e])}).on("poptrox_reset",function(){t(),x.css("position",f).css("z-index",i.baseZIndex+1).css("width",i.popupWidth+"px").css("height",i.popupHeight+"px").css("left",s/2+"px").css("top",r/2+"px").css("top",r/2+"px").css("margin-left",-1*(x.outerWidth()/2)+"px").css("margin-top",-1*(x.outerHeight()/2)+"px"),b.hide().trigger("stopSpinning"),m.hide(),S.hide(),P.hide(),v.hide(),w.detach()}).on("poptrox_open",function(e,o){return d?!0:(d=!0,i.useBodyOverflow&&n.css("overflow","hidden"),i.onPopupOpen&&i.onPopupOpen(),void a.fadeTo(i.fadeSpeed,i.overlayOpacity,function(){x.trigger("poptrox_switch",[o,!0])}))}).on("poptrox_switch",function(o,p,n){var a;return!n&&d?!0:(d=!0,m.hide(),w.attr("src")&&w.attr("src",""),w.detach(),a=u[p],w=a.object,w.off("load"),v.css("text-indent","-9999em").show().append(w),"ajax"==a.type?e.get(a.src,function(e){w.html(e),w.trigger("load")}):w.attr("src",a.src),"image"!=a.type&&w.css("position","relative").css("outline","0").css("z-index",i.baseZIndex+100).width(a.width).height(a.height),b.trigger("startSpinning").fadeIn(300),x.show(),i.popupIsFixed?(x.width(i.popupWidth).height(i.popupHeight).css("margin-left",-1*(x.innerWidth()/2)+"px").css("margin-top",-1*(x.innerHeight()/2)+"px"),w.load(function(){w.off("load"),b.hide().trigger("stopSpinning"),m.trigger("update",[a.captionText]).fadeIn(i.fadeSpeed),S.fadeIn(i.fadeSpeed),v.css("text-indent",0).hide().fadeIn(i.fadeSpeed,function(){d=!1}),l=p,P.fadeIn(i.fadeSpeed)})):w.load(function(){w.off("load"),t();var e=Math.abs(x.width()-x.outerWidth()),o=Math.abs(x.height()-x.outerHeight()),n=w.width(),c=w.height(),u=s-2*i.windowMargin-e,h=r-2*i.windowMargin-o;b.hide().trigger("stopSpinning"),(n>u||c>h)&&(u=Math.min(u/n,h/c),n=Math.floor(u*n),c=Math.floor(u*c),w.width(n).height(c)),x.innerWidth()==n+e&&x.innerHeight()==c+o?(m.trigger("update",[a.captionText]).fadeIn(i.fadeSpeed),S.fadeIn(i.fadeSpeed),v.css("text-indent",0).hide().fadeIn(i.fadeSpeed,function(){d=!1}),l=p):x.animate({width:n,height:c,marginLeft:-1*(n/2)-e/2,marginTop:-1*(c/2)-o/2},i.popupSpeed,"swing",function(){m.trigger("update",[a.captionText]).fadeIn(i.fadeSpeed),S.fadeIn(i.fadeSpeed),v.css("text-indent",0).hide().fadeIn(i.fadeSpeed,function(){d=!1}),l=p,P.fadeIn(i.fadeSpeed)})}),void("image"!=a.type&&w.trigger("load")))}).on("poptrox_close",function(){return d?!0:(d=!0,x.hide().trigger("poptrox_reset"),i.onPopupClose&&i.onPopupClose(),void a.fadeOut(i.fadeSpeed,function(){i.useBodyOverflow&&n.css("overflow","auto"),d=!1}))}).prependTo("body").hide().trigger("poptrox_reset"),c.keydown(function(e){if(x.is(":visible"))switch(e.keyCode){case 37:case 32:if(i.usePopupNav)return x.trigger("poptrox_previous"),!1;break;case 39:if(i.usePopupNav)return x.trigger("poptrox_next"),!1;break;case 27:return x.trigger("poptrox_close"),!1}}),o.find(i.selector).each(function(o){var t,p,s=e(this),r=s.find("img");if(p=s.data("poptrox"),t={src:s.attr("href"),captionText:r.attr("title"),width:s.attr("width"),height:s.attr("height"),type:null,object:null},p){var n,a=p.split(",");for(n in a)(p=a[n].match(/([0-9]+)x([0-9]+)/))&&3==p.length?(t.width=p[1],t.height=p[2]):t.type=a[n]}if(!t.type)switch(p=t.src.match(/http[s]?:\/\/([a-z0-9\.]+)\/.*/),(!p||3>p.length)&&(p=[!1]),p[1]){case"api.soundcloud.com":t.type="soundcloud";break;case"youtu.be":t.type="youtube";break;case"vimeo.com":t.type="vimeo";break;default:t.type="image"}switch((p=t.src.match(/http([s]?):\/\/[a-z0-9\.]+\/(.*)/))&&(t.prefix="http"+("s"==p[1]?"s":"")),t.type){case"ignore":break;case"iframe":t.object=e('<iframe src="" frameborder="0"></iframe>'),t.object.on("click",function(e){e.stopPropagation()}).css("cursor","auto");break;case"ajax":t.object=e('<div class="poptrox-ajax"></div>'),t.object.on("click",function(e){e.stopPropagation()}).css("cursor","auto").css("overflow","auto");break;case"soundcloud":t.object=e('<iframe scrolling="no" frameborder="no" src=""></iframe>'),t.src=t.prefix+"://w.soundcloud.com/player/?url="+escape(t.src),t.width="600",t.height="166";break;case"youtube":t.object=e('<iframe src="" frameborder="0" allowfullscreen="1"></iframe>'),t.src=t.prefix+"://www.youtube.com/embed/"+p[2];break;case"vimeo":t.object=e('<iframe src="" frameborder="0" allowFullScreen="1"></iframe>'),t.src=t.prefix+"://player.vimeo.com/video/"+p[2];break;default:t.object=e('<img src="" alt="" />'),i.preload&&(p=document.createElement("img"),p.src=t.src,h.push(p))}u.push(t),r.attr("title",""),"ignore"!=t.type&&s.attr("href","").css("outline",0).on("click",function(e){e.preventDefault(),e.stopPropagation(),x.trigger("poptrox_open",[o])})}),e(this)}}(jQuery);